<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>klay’s simple cookbook for Linux, v0.8.0a</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<header id="title-block-header">
<h1 class="title">klay’s simple cookbook for Linux, <a href="https://github.com/klaymu/self-host">v0.8.0a</a></h1>
</header>
<nav id="TOC">
<ul>
<li><a href="#introduction">introduction</a><ul>
<li><a href="#why-a-cookbook">why a cookbook?</a></li>
<li><a href="#why-all-the-lowercase">why all the lowercase?</a></li>
<li><a href="#who-is-your-audience">who is your audience?</a></li>
</ul></li>
<li><a href="#materials">materials</a></li>
<li><a href="#usernames-and-passwords">usernames and passwords</a></li>
<li><a href="#operating-system">operating system</a></li>
</ul>
</nav>
<section id="introduction" class="level2">
<h2>introduction</h2>
<section id="why-a-cookbook" class="level3">
<h3>why a cookbook?</h3>
<p>there’s an old <a href="https://reddit.com/r/geek/comments/4zl3e1/happy_birthday_linux_heres_your_cake">joke</a> that using Linux is like ordering a cake and receiving a bunch of flour, sugar, butter, and eggs. many self-hosting tutorials read like the back of a box of cake mix, which is great if you want a cake fast, but unsatisfying if you want to learn about cake making. my goal is for this guide to teach you enough to improvise, to make substitutions.</p>
</section>
<section id="why-all-the-lowercase" class="level3">
<h3>why all the lowercase?</h3>
<p>a few people have asked me this. honestly I have some <a href="https://seximal.net">influences</a> but the main reason is that it reminds me of writing code. in code, uppercase letters are almost always reserved for names. I did my best to capitalize all names in this document the way their owners capitalize them, so the web protocol is HTTP, but the comic strip is xkcd.</p>
</section>
<section id="who-is-your-audience" class="level3">
<h3>who is your audience?</h3>
<p>this guide is for you if:</p>
<ul>
<li>you’re me, and you forgot how you did this last time.</li>
<li>you want to share pictures and videos and don’t want to use a commercial file host.</li>
<li>you want to run a communal server, like <a href="https://tilde.club">tilde.club</a>.</li>
<li>you’re just curious about Linux and servers!</li>
</ul>
<p>sound good? then let’s get cooking.</p>
</section>
</section>
<section id="materials" class="level2">
<h2>materials</h2>
<p>I’ll be using a <a href="https://www.raspberrypi.com">Raspberry Pi 4b</a> and installing [Raspberry Pi OS]. it’s also known as Raspbian, since it’s based on <a href="https://www.debian.org/doc">Debian</a> Linux. any Debian-like OS will work for this tutorial. if the Raspberry Pi isn’t available where and when you are, some good alternatives are the <a href="https://libre.computer/products/roc-rk3328-cc">Renegade</a> or the <a href="https://www.pine64.org/devices/single-board-computers/rock64">ROCK64</a>, running <a href="https://www.armbian.com">armbian</a> Linux.</p>
<p>you’ll also need a MicroSD card, a hard drive, and a second hard drive for backup. I recommend a 64GB MicroSD card and two 2TB hard drives. the Pi can power one hard drive via USB, but if you want to plug both in at once you’ll need a powered hard drive enclosure or a powered USB hub.</p>
<p>you can also adapt these directions to existing hardware you may already own, like an old laptop or desktop pc. you can also rent a virtual machine from a remote datacenter! the cheapest virtual machine on <a href="https://www.digitalocean.com">DigitalOcean</a> right now (as of 2023 July) costs 6 USD per month, and comes with 25GB of storage. renting a machine in a datacenter means you gget the perks of high-speed internet all day and night, which is great if you are running a game server and need a fast connection. however, you’ll pay 10 USD per month for each 100GB of additional storage, so it’s not great if you want to host a huge media archive.</p>
<!-- todo: what about S3-compatible storage? -->
</section>
<section id="usernames-and-passwords" class="level2">
<h2>usernames and passwords</h2>
<p>at some point you’ll probably want to make your server available on the internet. there are bots out there that do nothing but guess random usernames and passwords all day, and they <em>will</em> find you, so you need to be prepared.</p>
<p>for your username, pick something short and catchy. in my experience, a typical linux username is from 3 to 8 characters long. if you have a short name like ‘alice’ or ‘bob’ you can use that. if you have a nickname online like ‘azure’ or ‘luna’ then that works too. if you have a middle name, you can use your initials, like ‘jfk’. your username should be all lowercase.</p>
<p>for your password, the most important factor is length. I know you’ve been told that you need to add weird symbols and stuff in it, but that rule is for older more limited systems. it’s the 64-bit era, baby! the only thing that matters is how much entropy your password has. <strong>entropy</strong> is basically a measure of how unlikely something is to happen twice. like if I flip ten coins and you flip ten coins and we get the same sequence, the odds of that happening are 1 in 2^10, so we say that that particular sequence of flips has 10 “bits” of entropy. it’s recommended that your password have about 60 to 80 bits of entropy. yikes, that’s a lot of coin flips to memorize!</p>
<p>luckily there’s a better way. using a tool like <a href="https://xkpasswd.net/s/">xkpasswd</a> or <a href="https://theworld.com/~reinhold/diceware.html">diceware</a>, you can convert randomness into words. using the diceware list, you can roll 25 six-sided dice to get a random 25-digit sequence, and then convert each 5 digits into a word, to get a 5-word phrase. the odds of two people getting the same 5-word phrase are 1 in 6^25, which is approximately equal to 2^64, so this password has 64 bits of entropy. that’s enough to make most hackers give up and move onto an easier target. go generate a password now, and save it somewhere safe, like a password manager program, or a piece of paper tucked inside a book. don’t be afraid to write things down; you can’t hack a piece of paper.</p>
</section>
<section id="operating-system" class="level2">
<h2>operating system</h2>
<p>time to download and install your operating system. there are lots of guides on how to install Linux already, <a href="https://www.raspberrypi.com/documentation/computers/getting-started.html">here’s</a> one for Raspbian. I’ll be using "Raspberry Pi OS Lite (64-Bit), with the default settings. with these settings, there is no remote login available; you will need to plug a keyboard and monitor directly into the pi. on the first boot, you’ll be prompted to enter the username and password for the initial user. after that, you’ll be given a login prompt. log in with the username and password you just set. some operating systems display nothing at a password prompt, not even stars. once you log in, you’ll see some system information, and then a prompt that looks like</p>
<pre><code>user@raspberrypi:~ $</code></pre>
<p>this is a <strong>CLI</strong>, a command line interface. from left to right, this contains</p>
<ul>
<li>your name</li>
<li>the machine’s name</li>
<li>your current directory. <code>~</code> means “home”, and is short for <code>/home/user</code>.</li>
<li>a command prompt. this will be <code>$</code> if you are in user mode, or <code>#</code> if you are in admin mode.</li>
</ul>
<p>if you’ve ever used a bot in a chatroom, you already know how to use a command line interface! it’s a system where you type an instruction, and the computer answers you. here are some examples of commands you can type:</p>
<ul>
<li><code>whoami</code>: ask the computer what your name is.</li>
<li><code>hostname</code>: ask the computer what <em>its</em> name is.</li>
<li><code>pwd</code>: ask the computer where you are.</li>
<li><code>ls</code>: look at the files in your current location.</li>
<li><code>cd &lt;somewhere&gt;</code>: go somewhere else.</li>
<li><code>echo &lt;something&gt;</code>: ask the computer to repeat something back to you.</li>
<li><code>nano &lt;filename&gt;</code>: edit a text file.</li>
<li><code>cat &lt;filename&gt;</code>: print a text file to the screen.</li>
</ul>
<p>if this is your first time using a command line interface, try some of these commands now. use <code>nano myfile.txt</code> to open a text file, write some text to it, then save with ctrl-o, and exit with ctrl-x. use <code>ls</code> to look at that file, then use <code>cat myfile.txt</code> to have the computer read it back to you. pat yourself on the back, you’re learning so much!</p>
<p>soon we’ll unplug the keyboard and monitor from this computer, making it a ‘headless’ server. before we can do that we need to run a few commands as administrator, or ‘root’. we’ll do this with a very powerful command called <code>sudo</code>. sudo stands for ‘super user do’, and it means ‘do the next thing as an administrator’. you can use <code>sudo &lt;whatever&gt;</code> for a single command, or enter interactive mode with <code>sudo -i</code>. in interactive mode, <em>all</em> your commands will be admin commands, until you say <code>exit</code>.</p>
<p><span class="emoji" data-emoji="warning">⚠️</span> <strong>there is no undo button! if you say something with sudo, make sure you mean it!</strong></p>
<p>throughout this guide, I’ll be using <code>$</code> at the start of a command if you run it as a normal user, or <code>#</code> if you run it as admin. either way, you don’t actually type this symbol yourself, it should already appear on your command line.</p>
<p>we’ll need to do these things before we can go headless:</p>
<ul>
<li>change <code>sudo</code> to require a password</li>
<li>change the hostname from the default</li>
<li>connect to a network</li>
<li>enable remote login</li>
<li>install operating system updates</li>
<li>reboot</li>
</ul>
<p>first we’ll change the sudo rules for our account. there should be a config file at <code>/etc/sudoers.d/010_pi-nopasswd</code>. we’ll use the special <code>visudo</code> command to edit it, which should launch <code>nano</code> like before, but with special safety guards to catch us if we lock ourselves out of administrator mode.</p>
<pre><code>$ sudo visudo /etc/sudoers.d/010_pi-nopasswd</code></pre>
<p>you should see a single line, like</p>
<pre><code>user ALL=(ALL) NOPASSWD: ALL</code></pre>
<p>remove the <code>NOPASSWD:</code> instruction, so this file reads</p>
<pre><code>user ALL=(ALL) ALL</code></pre>
<p>save and quit. from now on, if you haven’t used <code>sudo</code> in a few minutes, the system will ask for your password. this way if you accidentally leave yourself logged in, and someone else takes over your session, they won’t automatically get sudo access.</p>
<p>we can do the next few steps with the <code>raspi-config</code> tool.</p>
<pre><code>$ sudo raspi-config</code></pre>
<p>the hostname is under System Options -&gt; Hostname. I set mine to ‘teapot’.</p>
<p>if your machine is plugged directly into your home router with a patch cable, you already have network access, otherwise set up wireless with System Options -&gt; Wireless LAN.</p>
<p>to log in remotely, go to Interface Options -&gt; SSH.</p>
<p>select ‘Finish’. you’ll be prompted to reboot, but don’t yet, we’ll reboot later after installing some updates. in Debian Linux, we update packages using a tool called <code>apt</code>. <code>apt update</code> checks for updated packages, and <code>apt upgrade</code> installs them. run both these commands now, using the interactive version of <code>sudo</code>.</p>
<pre><code>$ sudo -i
# apt update
# apt upgrade</code></pre>
<p>finally, if you’re on a Raspberry Pi, then <code>avahi-daemon</code> is installed automatically. if not, you may need to install it yourself. this program broadcasts your hostname to the network, so you can log in remotely without configuring anything on your router.</p>
<pre><code># apt install avahi-daemon</code></pre>
<p>now go ahead and reboot, to make sure your new hostname is in use.</p>
<pre><code># reboot</code></pre>
<p>after a minute, you should now be able to log in remotely from another computer, using</p>
<pre><code>$ ssh user@teapot</code></pre>
<p>or</p>
<pre><code>$ ssh user@teapot.local</code></pre>
<p>if this works, congrats! you can now unplug the keyboard and monitor. you’ve created a headless server.</p>
</section>
</body>
</html>
